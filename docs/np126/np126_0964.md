# 性能

> 原文：[`numpy.org/doc/1.26/reference/random/performance.html`](https://numpy.org/doc/1.26/reference/random/performance.html)

## 推荐

通用用途推荐的生成器是`PCG64`或其升级版`PCG64DXSM`，适用于高度并行的用例。它们在大多数平台上具有统计学上的高质量、完整功能并且运行速度快，但在 32 位进程编译时略慢。有关何时使用`PCG64DXSM`进行重型并行的详细信息，请参阅使用 PCG64DXSM 升级 PCG64。

`Philox`相对较慢，但其统计属性非常高质量，通过使用唯一密钥可以轻松获得确定性独立的流。如果这是您希望用于并行流的样式，或者您正在从使用该样式的其他系统进行移植，那么`Philox`是您的选择。

`SFC64`具有统计上的高质量和非常快的运行速度。然而，它缺乏可跳跃性。如果您不使用该功能并且希望在 32 位进程上也能获得很高的速度，这是您的选择。

`MT19937` [未通过某些统计测试](https://www.iro.umontreal.ca/~lecuyer/myftp/papers/testu01.pdf)，与现代伪随机数生成器相比速度不是特别快。基于这些原因，我们大多不建议单独使用它，只通过遗留的`RandomState`来重现旧的结果。尽管如此，作为许多系统中的默认值，它有着非常悠久的历史。

## 时间

下面的时间是生成特定分布的 1 个随机值所需的时间（单位：纳秒）。由于需要 2 个 32 位值才能等于更快的生成器的输出，原始的`MT19937`生成器要慢得多。

整数性能具有类似的排序。

对于其他更复杂的发生器，其模式也类似。传统 `RandomState` 生成器的正常性能要低得多，因为它使用的是 Box-Muller 变换而不是 Ziggurat 方法。对于指数分布的性能差距也很大，这是由于计算对数函数以反演 CDF 的成本很高。标有 MT19973 的列使用与 `RandomState` 相同的 32 位生成器，但是利用 `Generator` 生成随机变量。

|  | MT19937 | PCG64 | PCG64DXSM | Philox | SFC64 | RandomState |
| --- | --- | --- | --- | --- | --- | --- |
| 32 位无符号整数 | 3.3 | 1.9 | 2.0 | 3.3 | 1.8 | 3.1 |
| 64 位无符号整数 | 5.6 | 3.2 | 2.9 | 4.9 | 2.5 | 5.5 |
| 均匀分布 | 5.9 | 3.1 | 2.9 | 5.0 | 2.6 | 6.0 |
| 正态分布 | 13.9 | 10.8 | 10.5 | 12.0 | 8.3 | 56.8 |
| 指数 | 9.1 | 6.0 | 5.8 | 8.1 | 5.4 | 63.9 |
| 伽玛分布 | 37.2 | 30.8 | 28.9 | 34.0 | 27.5 | 77.0 |
| 二项分布 | 21.3 | 17.4 | 17.6 | 19.3 | 15.6 | 21.4 |
| 拉普拉斯分布 | 73.2 | 72.3 | 76.1 | 73.0 | 72.3 | 82.5 |
| 泊松分布 | 111.7 | 103.4 | 100.5 | 109.4 | 90.7 | 115.2 |

下一个表格显示了性能相对于传统生成器 `RandomState(MT19937())` 生成值的百分比。整体性能是使用几何均值计算的。

|  | MT19937 | PCG64 | PCG64DXSM | Philox | SFC64 |
| --- | --- | --- | --- | --- | --- |
| 32 位无符号整数 | 96 | 162 | 160 | 96 | 175 |
| 64 位无符号整数 | 97 | 171 | 188 | 113 | 218 |
| 均匀分布 | 102 | 192 | 206 | 121 | 233 |
| 正态分布 | 409 | 526 | 541 | 471 | 684 |
| 指数 | 701 | 1071 | 1101 | 784 | 1179 |
| 伽玛分布 | 207 | 250 | 266 | 227 | 281 |
| 二项式分布 | 100 | 123 | 122 | 111 | 138 |
| 拉普拉斯分布 | 113 | 114 | 108 | 113 | 114 |
| 泊松分布 | 103 | 111 | 115 | 105 | 127 |
| 总体 | 159 | 219 | 225 | 174 | 251 |

注

所有时间均使用 AMD Ryzen 9 3900X 处理器在 Linux 上进行。

## 不同操作系统上的性能

不同平台的性能存在差异，这是因为编译器和硬件可用性（如寄存器宽度）的差异。默认比特生成器已被选为在 64 位平台上表现良好。32 位操作系统的性能则截然不同。

报告的值是相对于每个表中 MT19937 速度的归一化值。值为 100 表示性能与 MT19937 相匹配。较高的值表示性能提高。这些值不能跨表进行比较。

### 64 位 Linux

| 分布 | MT19937 | PCG64 | PCG64DXSM | Philox | SFC64 |
| --- | --- | --- | --- | --- | --- |
| 32 位无符号整数 | 100 | 168 | 166 | 100 | 182 |
| 64 位无符号整数 | 100 | 176 | 193 | 116 | 224 |
| 均匀分布 | 100 | 188 | 202 | 118 | 228 |
| 正态分布 | 100 | 128 | 132 | 115 | 167 |
| 指数 | 100 | 152 | 157 | 111 | 168 |
| 总体 | 100 | 161 | 168 | 112 | 192 |

### 64 位 Windows

在 64 位 Linux 和 64 位 Windows 上的相对性能大致相似，但与 Philox 生成器明显不同。

| 分布 | MT19937 | PCG64 | PCG64DXSM | Philox | SFC64 |
| --- | --- | --- | --- | --- | --- |
| 32 位 无符号整数 | 100 | 155 | 131 | 29 | 150 |
| 64 位 无符号整数 | 100 | 157 | 143 | 25 | 154 |
| 均匀分布 | 100 | 151 | 144 | 24 | 155 |
| 正态分布 | 100 | 129 | 128 | 37 | 150 |
| 指数分布 | 100 | 150 | 145 | 28 | 159 |
| **总体** | 100 | 148 | 138 | 28 | 154 |

### 32 位 Windows

64 位生成器在 32 位 Windows 上的性能远远低于 64 位操作系统，这是由于寄存器宽度。自 2005 年以来一直在 NumPy 中的生成器 MT19937 使用 32 位整数进行操作。

| 分布 | MT19937 | PCG64 | PCG64DXSM | Philox | SFC64 |
| --- | --- | --- | --- | --- | --- |
| 32 位 无符号整数 | 100 | 24 | 34 | 14 | 57 |
| 64 位 无符号整数 | 100 | 21 | 32 | 14 | 74 |
| 均匀分布 | 100 | 21 | 34 | 16 | 73 |
| 正态分布 | 100 | 36 | 57 | 28 | 101 |
| 指数分布 | 100 | 28 | 44 | 20 | 88 |
| **总体** | 100 | 25 | 39 | 18 | 77 |

注意

Linux 时间使用 Ubuntu 20.04 和 GCC 9.3.0。Windows 时间使用 Windows 10 并使用 Microsoft C/C++ 优化编译器版本 19 (Visual Studio 2019)。所有时间均在 AMD Ryzen 9 3900X 处理器上生成。

## 推荐

用于一般用途的推荐生成器是 `PCG64` 或其升级变体 `PCG64DXSM`，用于密集并行使用情况。它们在统计上具有高质量、功能齐全，在大多数平台上运行速度快，但在编译为 32 位进程时略慢。有关何时指示使用 `PCG64DXSM` 的详细信息，请参见 将 PCG64 升级为 PCG64DXSM。

`Philox` 是相当慢的，但其统计特性非常高，使用唯一键可以轻松获得保证独立的流。如果这是您希望用于并行流的风格，或者您正在从使用该风格的其他系统进行移植，则 `Philox` 是您的选择。

`SFC64` 在统计上具有高质量并且非常快速。然而，它缺乏可跳跃性。如果您不使用该功能，并且想要大量速度，甚至在 32 位进程上，这是您的选择。

`MT19937` [在一些统计测试中失败](https://www.iro.umontreal.ca/~lecuyer/myftp/papers/testu01.pdf)，与现代 PRNG 相比也不特别快。因此，我们大多数情况下不推荐单独使用它，而是通过遗留的 `RandomState` 来复现旧的结果。尽管如此，在许多系统中，它作为默认选项存在已有很长时间的历史。

## 运行时间

以下计时是以纳秒为单位生成特定分布的 1 个随机值所需的时间。原始的 `MT19937` 生成器较慢，因为它需要 2 个 32 位值才能等于更快生成器的输出。

整数性能具有类似的顺序。

对于其他更复杂的生成器，模式是相似的。由于它使用的是 Box-Muller 方法而不是 Ziggurat 方法，旧的 `RandomState` 生成器的正常表现远低于其他生成器。指数分布的性能差距也很大，这是由于计算对数函数以求逆 CDF 的成本较高。标记为 MT19973 的列使用与 `RandomState` 相同的 32 位生成器，但使用 `Generator` 生成随机变量。

|  | MT19937 | PCG64 | PCG64DXSM | Philox | SFC64 | RandomState |
| --- | --- | --- | --- | --- | --- | --- |
| 32 位无符号整数 | 3.3 | 1.9 | 2.0 | 3.3 | 1.8 | 3.1 |
| 64 位无符号整数 | 5.6 | 3.2 | 2.9 | 4.9 | 2.5 | 5.5 |
| 均匀分布 | 5.9 | 3.1 | 2.9 | 5.0 | 2.6 | 6.0 |
| 正态分布 | 13.9 | 10.8 | 10.5 | 12.0 | 8.3 | 56.8 |
| 指数分布 | 9.1 | 6.0 | 5.8 | 8.1 | 5.4 | 63.9 |
| Gammas | 37.2 | 30.8 | 28.9 | 34.0 | 27.5 | 77.0 |
| 二项分布 | 21.3 | 17.4 | 17.6 | 19.3 | 15.6 | 21.4 |
| Laplaces | 73.2 | 72.3 | 76.1 | 73.0 | 72.3 | 82.5 |
| 泊松分布 | 111.7 | 103.4 | 100.5 | 109.4 | 90.7 | 115.2 |

下表以相对于使用旧生成器 `RandomState(MT19937())` 生成的值的百分比的形式展示了性能。整体性能是使用几何平均计算得出的。

|  | MT19937 | PCG64 | PCG64DXSM | Philox | SFC64 |
| --- | --- | --- | --- | --- | --- |
| 32 位无符号整数 | 96 | 162 | 160 | 96 | 175 |
| 64 位无符号整数 | 97 | 171 | 188 | 113 | 218 |
| 均匀分布 | 102 | 192 | 206 | 121 | 233 |
| 正态分布 | 409 | 526 | 541 | 471 | 684 |
| 指数分布 | 701 | 1071 | 1101 | 784 | 1179 |
| Gammas | 207 | 250 | 266 | 227 | 281 |
| 二项分布 | 100 | 123 | 122 | 111 | 138 |
| Laplaces | 113 | 114 | 108 | 113 | 114 |
| 泊松分布 | 103 | 111 | 115 | 105 | 127 |
| 总体性能 | 159 | 219 | 225 | 174 | 251 |

注意

所有的计时都是在 AMD Ryzen 9 3900X 处理器上使用 Linux 进行的。

## 不同操作系统上的性能

由于编译器和硬件可用性（例如，寄存器宽度）的不同，表现在不同平台上有所不同。默认比特生成器被选择为在 64 位平台上表现良好。在 32 位操作系统上性能差别非常大。

报告的数值是相对于每个表中 MT19937 速度的正常化值。数值为 100 表示性能与 MT19937 匹配。数值越高表示性能越好。这些数值不能在各表之间进行比较。

### 64 位 Linux

| 分布 | MT19937 | PCG64 | PCG64DXSM | Philox | SFC64 |
| --- | --- | --- | --- | --- | --- |
| 32 位无符号整数 | 100 | 168 | 166 | 100 | 182 |
| 64 位无符号整数 | 100 | 176 | 193 | 116 | 224 |
| 均匀性 | 100 | 188 | 202 | 118 | 228 |
| 标准 | 100 | 128 | 132 | 115 | 167 |
| 指数 | 100 | 152 | 157 | 111 | 168 |
| **总体** | 100 | 161 | 168 | 112 | 192 |

### 64 位 Windows

相对于 64 位 Linux 和 64 位 Windows 的性能大致相似，但 Philox 生成器是个显著的例外。

| 分布 | MT19937 | PCG64 | PCG64DXSM | Philox | SFC64 |
| --- | --- | --- | --- | --- | --- |
| 32 位无符号整数 | 100 | 155 | 131 | 29 | 150 |
| 64 位无符号整数 | 100 | 157 | 143 | 25 | 154 |
| 均匀性 | 100 | 151 | 144 | 24 | 155 |
| 标准 | 100 | 129 | 128 | 37 | 150 |
| 指数 | 100 | 150 | 145 | 28 | 159 |
| **总体** | 100 | 148 | 138 | 28 | 154 |

### 32 位 Windows

64 位生成器在 32 位 Windows 上的性能远低于 64 位操作系统，这是由于寄存器宽度引起的。自 2005 年以来一直存在于 NumPy 中的 MT19937 生成器使用 32 位整数。

| 分布 | MT19937 | PCG64 | PCG64DXSM | Philox | SFC64 |
| --- | --- | --- | --- | --- | --- |
| 32 位无符号整数 | 100 | 24 | 34 | 14 | 57 |
| 64 位无符号整数 | 100 | 21 | 32 | 14 | 74 |
| 均匀性 | 100 | 21 | 34 | 16 | 73 |
| 标准 | 100 | 36 | 57 | 28 | 101 |
| 指数 | 100 | 28 | 44 | 20 | 88 |
| **总体** | 100 | 25 | 39 | 18 | 77 |

注意

Linux 时间使用 Ubuntu 20.04 和 GCC 9.3.0。Windows 时间在 Windows 10 上使用 Microsoft C/C++优化编译器版本 19（Visual Studio 2019）进行。所有时间均在 AMD Ryzen 9 3900X 处理器上产生。

### 64 位 Linux

| 分布 | MT19937 | PCG64 | PCG64DXSM | Philox | SFC64 |
| --- | --- | --- | --- | --- | --- |
| 32 位无符号整数 | 100 | 168 | 166 | 100 | 182 |
| 64 位无符号整数 | 100 | 176 | 193 | 116 | 224 |
| 均匀性 | 100 | 188 | 202 | 118 | 228 |
| 标准 | 100 | 128 | 132 | 115 | 167 |
| 指数 | 100 | 152 | 157 | 111 | 168 |
| **总体** | 100 | 161 | 168 | 112 | 192 |

### 64 位 Windows

相对于 64 位 Linux 和 64 位 Windows 的性能大致相似，但 Philox 生成器是个显著的例外。

| 分布 | MT19937 | PCG64 | PCG64DXSM | Philox | SFC64 |
| --- | --- | --- | --- | --- | --- |
| 32 位无符号整数 | 100 | 155 | 131 | 29 | 150 |
| 64 位无符号整数 | 100 | 157 | 143 | 25 | 154 |
| 统一 | 100 | 151 | 144 | 24 | 155 |
| 正态分布 | 100 | 129 | 128 | 37 | 150 |
| 指数 | 100 | 150 | 145 | 28 | 159 |
| **总体** | 100 | 148 | 138 | 28 | 154 |

### 32 位 Windows

64 位生成器在 32 位 Windows 上的性能远低于 64 位操作系统，这是由于寄存器宽度造成的。自 2005 年以来在 NumPy 中存在的生成器 MT19937 是基于 32 位整数运行的。

| 分布 | MT19937 | PCG64 | PCG64DXSM | Philox | SFC64 |
| --- | --- | --- | --- | --- | --- |
| 32 位无符号整数 | 100 | 24 | 34 | 14 | 57 |
| 64 位无符号整数 | 100 | 21 | 32 | 14 | 74 |
| 统一 | 100 | 21 | 34 | 16 | 73 |
| 正态分布 | 100 | 36 | 57 | 28 | 101 |
| 指数 | 100 | 28 | 44 | 20 | 88 |
| **总体** | 100 | 25 | 39 | 18 | 77 |

注意

Linux 的计时使用了 Ubuntu 20.04 和 GCC 9.3.0。Windows 的计时是在 Windows 10 上使用 Microsoft C/C++优化编译器版本 19（Visual Studio 2019）进行的。所有计时都是在 AMD Ryzen 9 3900X 处理器上完成的。
