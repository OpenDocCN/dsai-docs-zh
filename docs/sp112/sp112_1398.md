# 贡献方式

> 原文：[https://docs.scipy.org/doc/scipy-1.12.0/dev/hacking.html](https://docs.scipy.org/doc/scipy-1.12.0/dev/hacking.html)

本文旨在概述向SciPy贡献的方式。它试图回答常见问题并提供一些关于社区实际工作流程的见解。熟悉SciPy社区并且是有经验的Python编码者的读者可能希望直接跳转到[SciPy贡献者指南](contributor/contributor_toc.html#contributor-toc)。

有很多方式可以贡献：

+   贡献新代码

+   修复错误，改进文档，以及其他维护工作

+   审查开放的拉取请求

+   问题分类

+   在 [scipy.org](https://scipy.org/) 网站上工作

+   回答问题并参与 scipy-dev 和 scipy-user 的[邮件列表](https://scipy.org/community/#scipy-mailing-list)。

## 贡献新代码

如果你已经使用科学Python工具栈一段时间，可能会有一些代码堆积，你会觉得“这对其他人也可能有用”。也许将其贡献给SciPy或其他开源项目是个不错的主意。首先要问的问题是，这些代码应该放在哪里？这个问题在这里很难回答，所以我们从更具体的问题开始：*哪些代码适合放入SciPy？* 添加到SciPy的几乎所有新代码都具有一个共同点，那就是它在多个科学领域中有潜在的用途，并且它适合于现有SciPy子包的范围内（参见[决定新功能](core-dev/index.html#deciding-on-new-features)）。原则上，也可以添加新的子包，但这种情况较少见。对于特定于单一应用程序的代码，可能已经存在可以使用该代码的现有项目。一些SciKits（例如[scikit-learn](http://scikit-learn.org)、[scikit-image](http://scikit-image.org/)、[statsmodels](https://www.statsmodels.org/)等）在这里是很好的例子；它们的焦点更窄，因此比SciPy具有更多领域特定的代码。

现在，如果你有想要包含在SciPy中的代码，你应该怎么做呢？在确认你的代码可以在兼容的许可下分发给SciPy之前（参见[许可考虑](#license-considerations)），第一步是在scipy-dev邮件列表上讨论。所有新功能以及对现有代码的更改都在那里讨论和决定。你可以在你的代码完成之前开始这个讨论。请记住，为了添加到SciPy中，你的代码需要被其他人审查，因此尽量找到愿意审查你工作的人。

假设邮件列表上的讨论结果是积极的，并且你有一个能做你需要的事情的函数或代码片段，接下来呢？在代码添加到SciPy之前，它至少需要有良好的文档、单元测试、基准测试以及正确的代码风格。

1.  单元测试

    原则上，你应该创建能够测试你添加的所有代码的单元测试。这样可以在一定程度上确保你的代码在不同Python版本和你自己无法获得的硬件或操作系统上也能正确运行。如何撰写单元测试的详细描述可以在[测试指南](https://numpy.org/devdocs/reference/testing.html "(in NumPy v2.0.dev0)")中找到，而[本地运行SciPy测试](contributor/devpy_test.html#devpy-test)则说明了如何运行这些测试。

1.  基准测试

    单元测试检查正确功能；基准测试衡量代码性能。并非所有现有的SciPy代码都有基准测试，但应该有：随着SciPy的发展，监控执行时间以捕获意外的性能回归变得越来越重要。有关如何撰写和运行基准测试的更多信息可以在[Benchmarking SciPy with airspeed velocity](contributor/benchmarking.html#benchmarking-with-asv)中找到。

1.  文档

    清晰完整的文档对于用户能够查找和理解代码至关重要。单个函数和类的文档，包括至少基本描述、所有参数和返回值的类型和含义，以及[doctest](https://pymotw.com/3/doctest/)格式的使用示例，都放在文档字符串中。这些文档字符串可以在解释器中阅读，并编译成HTML和pdf格式的参考指南。关于如何撰写文档的指南可以在[文档风格](https://numpy.org/devdocs/dev/howto-docs.html#howto-document "(in NumPy v2.0.dev0)")中找到，而[使用Sphinx本地渲染文档](contributor/rendering_documentation.html#rendering-documentation)则解释了如何预览文档，看起来就像在线一样。

1.  代码风格

    统一的代码风格可以让其他人更容易阅读你的代码。SciPy遵循标准的Python风格指南，[PEP8](https://www.python.org/dev/peps/pep-0008/)，唯一的例外是推荐的最大行长度为88个字符，而不是PEP8的79个字符。

    我们提供一个git预提交钩子，可以检查每个提交的风格是否正确。通过以下命令在SciPy存储库的根目录安装它（一次性）：

    ```py
    cp tools/pre-commit-hook.py .git/hooks/pre-commit 
    ```

    或者，您也可以手动运行代码检查工具：

    ```py
    python dev.py lint 
    ```

    大多数集成开发环境（IDE）和文本编辑器都有设置，可以帮助你遵循PEP8，例如将制表符转换为四个空格。更多信息可以在[PEP8和SciPy](contributor/pep8.html#pep8-scipy)中找到。

一个[检查清单](contributor/development_workflow.html#pr-checklist)，包括这些和其他要求，可以在示例的末尾[开发工作流程](contributor/development_workflow.html#development-workflow)中找到。

您可能还有另一个问题：*我应该把我的代码放在哪里*？要回答这个问题，了解 SciPy 的公共 API（应用程序编程接口）的定义是很有用的。对于大多数模块来说，API 是两层深度的，这意味着您的新函数应该出现为 `scipy.subpackage.my_new_func`。`my_new_func` 可以放在 `/scipy/<subpackage>/` 下的现有或新文件中，其名称应添加到该文件中的 `__all__` 列表中（该列表列出文件中的所有公共函数），然后在 `/scipy/<subpackage>/__init__.py` 中导入这些公共函数。任何私有函数/类的名称应该以下划线（`_`）开头。SciPy 的公共 API 的更详细描述在 [SciPy API](../reference/index.html#scipy-api) 中给出。

一旦您认为您的代码准备好包含在 SciPy 中，您可以在 Github 上发送一个拉取请求（PR）。我们不会在这里详细讨论如何使用 git，这在 [Git for development](gitwash/gitwash.html#git-development) 和 [Github 帮助页面](https://help.github.com/articles/set-up-git/) 中有很好的描述。当您为一个新功能发送 PR 时，请确保在 scipy-dev 邮件列表上也提及此事。这可以促使感兴趣的人帮助审查您的 PR。假设您之前已经得到了关于您的代码/功能的总体想法的积极反馈，那么代码审查的目的是确保代码正确、高效并符合上述要求。在许多情况下，代码审查会相对快速完成，但也可能会停滞。如果您已经处理了所有已给反馈，那么在一定合理的时间（比如几周）之后，再次在邮件列表上请求审查是完全可以的。一旦审查完成，PR 就会合并到 SciPy 的“main”分支中。

上述描述了向 SciPy 添加代码的要求和过程。但它并没有准确回答决策是如何做出的问题。基本答案是：决策是通过共识达成的，由所有选择参与邮件列表讨论的人员决定。这包括开发人员、其他用户和你自己。在讨论中追求共识非常重要——SciPy 是科学 Python 社区的一个项目。在那些罕见的情况下，无法达成一致意见时，相关模块的维护者可以决定问题的解决方式。

### 许可证考虑

*我基于我在网上找到的现有 Matlab/R/... 代码编写了我的代码，这样可以吗？*

这取决于情况。SciPy 使用 BSD 许可证分发，因此如果您的代码基于的代码也是 BSD 许可证或具有 BSD 兼容许可证（例如 MIT、PSF），那么可以接受。如果代码是 GPL 或 Apache 许可证，没有明确的许可证，需要引用或仅适用于学术使用，则无法包含在 SciPy 中。因此，如果您复制了具有此类许可证的现有代码或直接将其翻译为 Python，则您的代码无法包含在内。如果您不确定，请在 scipy-dev 的[邮件列表](mailinglists)上咨询。

*SciPy 为何采用 BSD 许可证而不是 GPL？*

与 Python 一样，SciPy 使用“宽松”的开源许可证，允许专有重用。尽管如此，这使得公司可以在不返回任何东西的情况下使用和修改软件，但人们认为更大的用户基础会带来更多的贡献，公司通常也会发布它们的修改，而无需强制要求。请参阅约翰·亨特的[BSD 提案](https://web.archive.org/web/20130922065958/https://nipy.sourceforge.net/software/license/johns_bsd_pitch.html)。

有关 SciPy 许可证的更多信息，请参阅[Licensing](core-dev/index.html#scipy-licensing)。

## 维护现有代码

前面的部分特别讨论了向 SciPy 添加新功能。讨论的很大一部分也适用于现有代码的维护。维护意味着修复错误，提高代码质量，更好地记录现有功能，添加缺失的单元测试，添加性能基准，保持构建脚本的更新等等。SciPy 的[问题列表](https://github.com/scipy/scipy/issues)包含了所有报告的错误，构建/文档问题等。修复问题有助于提高 SciPy 的整体质量，并且也是熟悉项目的好方法。您可能还想修复一个错误，因为您遇到了这个问题，并且需要相关函数正常工作。

上述关于代码风格和单元测试的讨论同样适用于 bug 修复。通常最好先编写一个显示问题的单元测试，即该测试应该通过但实际未通过。一旦完成，您可以修复代码以使该测试通过。这应该足以为此问题发送一个 PR。与添加新代码时不同，可能不需要在邮件列表上讨论此问题 - 如果代码的旧行为显然是不正确的，那么没有人会反对将其修复。可能需要为更改后的行为添加一些警告或弃用消息。这应该是审查过程的一部分。

注意

不鼓励仅更改代码风格的拉取请求，例如修复文件中的一些 PEP8 问题。这些 PR 通常不值得在 git annotate 历史中堆砌，而且会占用审阅者的时间，这些时间可能更好地用在其他方面。但是，如果作为功能更改的一部分触及的代码进行了代码风格清理，则是可以接受的。

## 审查拉取请求

审查开放的拉取请求（PR）非常受欢迎，也是帮助项目前进速度的宝贵方式。如果您在特定领域具有特定的知识/经验（例如“优化算法”或“特殊函数”），那么审查该领域的 PR 尤为重要 - 有时具有技术代码的 PR 由于缺乏适当的审阅者而需要等待很长时间才能合并。

我们鼓励每个人参与审查过程；这也是熟悉代码库的好方法。审稿人应自问以下问题中的一些或全部：

+   此更改是否充分讨论（适用于新功能和更改现有行为）？

+   功能在科学上是否合理？算法可能基于文献已知工作；否则，对正确性的更近一步检查是宝贵的。

+   在所有情况下，预期行为是否清晰（例如，如空数组或 nan/inf 值等意外输入）？

+   代码是否符合[贡献新代码](#contributing-new-code)部分概述的质量、测试和文档期望？

如果我们还不认识您，请考虑介绍自己。

## 其他贡献方式

除编写代码外，还有许多贡献方式。

故障排除问题（验证错误报告的有效性和可能的行动）也是一种有用的活动。SciPy 有数百个开放问题；关闭无效问题并正确标记有效问题（最好在评论中提出一些初步想法）允许优先处理维护工作，并在处理现有功能或子包时轻松找到相关问题。有关问题排查的更多信息，请阅读[故障排查和问题管理](triage.html#triaging)。

参与 scipy-user 和 scipy-dev [邮件列表](https://scipy.org/community/#scipy-mailing-list)的讨论本身就是一种贡献。每个写信的人都希望得到回应，编写这些回应使项目和社区运行得更好，也更具欢迎性。

[scipy.org](https://scipy.org/) 网站包含关于 SciPy 项目和 SciPy 社区的大量信息，而且它总是需要新的帮手。网站的源代码存放在自己的单独存储库中：[https://github.com/scipy/scipy.org](https://github.com/scipy/scipy.org)

## 开始

感谢您对贡献 SciPy 的兴趣！如果您有兴趣贡献代码，希望您继续阅读[SciPy 贡献者指南](contributor/contributor_toc.html#contributor-toc)，了解如何设置开发环境、实现改进并提交首个 PR 的详细信息！
