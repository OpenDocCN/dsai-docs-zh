# 稀疏矩阵（scipy.sparse）

> 原文：[https://docs.scipy.org/doc/scipy-1.12.0/reference/sparse.html](https://docs.scipy.org/doc/scipy-1.12.0/reference/sparse.html)

SciPy 二维稀疏数组包，用于数值数据。

注意

此软件包正在切换到与 NumPy 数组兼容的数组接口，而不再使用旧的矩阵接口。我们建议您对所有新工作使用数组对象（[`bsr_array`](generated/scipy.sparse.bsr_array.html#scipy.sparse.bsr_array "scipy.sparse.bsr_array"), [`coo_array`](generated/scipy.sparse.coo_array.html#scipy.sparse.coo_array "scipy.sparse.coo_array") 等）。

在使用数组接口时，请注意：

+   `x * y` 现在不再执行矩阵乘法，而是执行元素级乘法（与 NumPy 数组类似）。为了使代码同时适用于数组和矩阵，使用 `x @ y` 来进行矩阵乘法。

+   诸如 *sum* 的操作，原先生成密集矩阵，现在生成数组，其乘法行为类似但有所不同。

+   稀疏数组目前必须是二维的。这也意味着这些对象上的所有 *切片* 操作必须产生二维结果，否则将导致错误。这将在未来版本中解决。

构造实用程序（[`eye`](generated/scipy.sparse.eye.html#scipy.sparse.eye "scipy.sparse.eye"), [`kron`](generated/scipy.sparse.kron.html#scipy.sparse.kron "scipy.sparse.kron"), [`random`](generated/scipy.sparse.random.html#scipy.sparse.random "scipy.sparse.random"), [`diags`](generated/scipy.sparse.diags.html#scipy.sparse.diags "scipy.sparse.diags") 等）尚未移植完成，但可以将其结果封装成数组：

```py
A = csr_array(eye(3)) 
```

## 内容

### 稀疏数组类

| [`bsr_array`](generated/scipy.sparse.bsr_array.html#scipy.sparse.bsr_array "scipy.sparse.bsr_array")(arg1[, shape, dtype, copy, blocksize]) | 块稀疏行（Block Sparse Row）格式的稀疏数组。 |
| --- | --- |
| [`coo_array`](generated/scipy.sparse.coo_array.html#scipy.sparse.coo_array "scipy.sparse.coo_array")(arg1[, shape, dtype, copy]) | COOrdinate 格式的稀疏数组。 |
| [`csc_array`](generated/scipy.sparse.csc_array.html#scipy.sparse.csc_array "scipy.sparse.csc_array")(arg1[, shape, dtype, copy]) | 压缩稀疏列（Compressed Sparse Column）数组。 |
| [`csr_array`](generated/scipy.sparse.csr_array.html#scipy.sparse.csr_array "scipy.sparse.csr_array")(arg1[, shape, dtype, copy]) | 压缩稀疏行（Compressed Sparse Row）数组。 |
| [`dia_array`](generated/scipy.sparse.dia_array.html#scipy.sparse.dia_array "scipy.sparse.dia_array")(arg1[, shape, dtype, copy]) | 带有对角线存储的稀疏数组。 |
| [`dok_array`](generated/scipy.sparse.dok_array.html#scipy.sparse.dok_array "scipy.sparse.dok_array")(arg1[, shape, dtype, copy]) | 基于键的字典（Dictionary Of Keys）稀疏数组。 |
| [`lil_array`](generated/scipy.sparse.lil_array.html#scipy.sparse.lil_array "scipy.sparse.lil_array")(arg1[, shape, dtype, copy]) | 基于行的列表（LIst of Lists）稀疏数组。 |
| [`sparray`](generated/scipy.sparse.sparray.html#scipy.sparse.sparray "scipy.sparse.sparray")() | 该类为所有稀疏数组提供基类。 |

### 稀疏矩阵类：

| [`bsr_matrix`](generated/scipy.sparse.bsr_matrix.html#scipy.sparse.bsr_matrix "scipy.sparse.bsr_matrix")(arg1[, shape, dtype, copy, blocksize]) | 块稀疏行格式的稀疏矩阵。 |
| --- | --- |
| [`coo_matrix`](generated/scipy.sparse.coo_matrix.html#scipy.sparse.coo_matrix "scipy.sparse.coo_matrix")(arg1[, shape, dtype, copy]) | COO 格式的稀疏矩阵。 |
| [`csc_matrix`](generated/scipy.sparse.csc_matrix.html#scipy.sparse.csc_matrix "scipy.sparse.csc_matrix")(arg1[, shape, dtype, copy]) | 压缩稀疏列矩阵。 |
| [`csr_matrix`](generated/scipy.sparse.csr_matrix.html#scipy.sparse.csr_matrix "scipy.sparse.csr_matrix")(arg1[, shape, dtype, copy]) | 压缩稀疏行矩阵。 |
| [`dia_matrix`](generated/scipy.sparse.dia_matrix.html#scipy.sparse.dia_matrix "scipy.sparse.dia_matrix")(arg1[, shape, dtype, copy]) | 带有对角线存储的稀疏矩阵。 |
| [`dok_matrix`](generated/scipy.sparse.dok_matrix.html#scipy.sparse.dok_matrix "scipy.sparse.dok_matrix")(arg1[, shape, dtype, copy]) | 基于键的字典稀疏矩阵。 |
| [`lil_matrix`](generated/scipy.sparse.lil_matrix.html#scipy.sparse.lil_matrix "scipy.sparse.lil_matrix")(arg1[, shape, dtype, copy]) | 基于行的链表稀疏矩阵。 |
| [`spmatrix`](generated/scipy.sparse.spmatrix.html#scipy.sparse.spmatrix "scipy.sparse.spmatrix")() | 该类为所有稀疏矩阵类提供基类。 |

### 函数：

构建稀疏数组：

| [`diags_array`](generated/scipy.sparse.diags_array.html#scipy.sparse.diags_array "scipy.sparse.diags_array")(diagonals, /, *[, offsets, ...]) | 从对角线构造稀疏数组。 |
| --- | --- |
| [`eye_array`](generated/scipy.sparse.eye_array.html#scipy.sparse.eye_array "scipy.sparse.eye_array")(m[, n, k, dtype, format]) | 稀疏数组格式中的单位矩阵 |
| [`random_array`](generated/scipy.sparse.random_array.html#scipy.sparse.random_array "scipy.sparse.random_array")(shape, *[, density, format, ...]) | 返回一个 [0, 1) 范围内均匀随机数的稀疏数组 |
| [`block_array`](generated/scipy.sparse.block_array.html#scipy.sparse.block_array "scipy.sparse.block_array")(blocks, *[, format, dtype]) | 从稀疏子块构建稀疏数组 |

构建稀疏矩阵：

| [`eye`](generated/scipy.sparse.eye.html#scipy.sparse.eye "scipy.sparse.eye")(m[, n, k, dtype, format]) | 对角线上有1的稀疏矩阵 |
| --- | --- |
| [`identity`](generated/scipy.sparse.identity.html#scipy.sparse.identity "scipy.sparse.identity")(n[, dtype, format]) | 稀疏格式中的单位矩阵 |
| [`diags`](generated/scipy.sparse.diags.html#scipy.sparse.diags "scipy.sparse.diags")(diagonals[, offsets, shape, format, dtype]) | 从对角线构造稀疏矩阵。 |
| [`spdiags`](generated/scipy.sparse.spdiags.html#scipy.sparse.spdiags "scipy.sparse.spdiags")(data, diags[, m, n, format]) | 从对角线返回稀疏矩阵。 |
| [`bmat`](generated/scipy.sparse.bmat.html#scipy.sparse.bmat "scipy.sparse.bmat")(blocks[, format, dtype]) | 从稀疏子块构建稀疏数组或矩阵 |
| [`random`](generated/scipy.sparse.random.html#scipy.sparse.random "scipy.sparse.random")(m, n[, density, format, dtype, ...]) | 生成给定形状和密度的稀疏矩阵，值为随机分布。 |
| [`rand`](generated/scipy.sparse.rand.html#scipy.sparse.rand "scipy.sparse.rand")(m, n[, density, format, dtype, ...]) | 生成给定形状和密度的稀疏矩阵，值均匀分布。 |

从更小的结构（数组或矩阵）构建更大的结构

| [`kron`](generated/scipy.sparse.kron.html#scipy.sparse.kron "scipy.sparse.kron")(A, B[, format]) | 稀疏矩阵A和B的Kronecker乘积 |
| --- | --- |
| [`kronsum`](generated/scipy.sparse.kronsum.html#scipy.sparse.kronsum "scipy.sparse.kronsum")(A, B[, format]) | 方阵稀疏矩阵A和B的Kronecker和 |
| [`block_diag`](generated/scipy.sparse.block_diag.html#scipy.sparse.block_diag "scipy.sparse.block_diag")(mats[, format, dtype]) | 从提供的矩阵构建块对角稀疏矩阵或数组 |
| [`tril`](generated/scipy.sparse.tril.html#scipy.sparse.tril "scipy.sparse.tril")(A[, k, format]) | 返回稀疏数组或矩阵的下三角部分 |
| [`triu`](generated/scipy.sparse.triu.html#scipy.sparse.triu "scipy.sparse.triu")(A[, k, format]) | 返回稀疏数组或矩阵的上三角部分 |
| [`hstack`](generated/scipy.sparse.hstack.html#scipy.sparse.hstack "scipy.sparse.hstack")(blocks[, format, dtype]) | 水平堆叠稀疏矩阵（按列） |
| [`vstack`](generated/scipy.sparse.vstack.html#scipy.sparse.vstack "scipy.sparse.vstack")(blocks[, format, dtype]) | 垂直堆叠稀疏数组（按行） |

保存和加载稀疏矩阵：

| [`save_npz`](generated/scipy.sparse.save_npz.html#scipy.sparse.save_npz "scipy.sparse.save_npz")(file, matrix[, compressed]) | 使用`.npz`格式将稀疏矩阵或数组保存到文件中。 |
| --- | --- |
| [`load_npz`](generated/scipy.sparse.load_npz.html#scipy.sparse.load_npz "scipy.sparse.load_npz")(file) | 使用`.npz`格式从文件加载稀疏数组/矩阵。 |

稀疏工具：

| [`find`](generated/scipy.sparse.find.html#scipy.sparse.find "scipy.sparse.find")(A) | 返回矩阵非零元素的索引和值 |
| --- | --- |

辨识稀疏数组：

+   使用 *isinstance(A, sp.sparse.sparray)* 检查是否为数组或矩阵。

+   使用 *A.format == ‘csr’* 来检查稀疏格式

辨识稀疏矩阵：

| [`issparse`](generated/scipy.sparse.issparse.html#scipy.sparse.issparse "scipy.sparse.issparse")(x) | *x* 是否为稀疏数组或稀疏矩阵类型？ |
| --- | --- |
| [`isspmatrix`](generated/scipy.sparse.isspmatrix.html#scipy.sparse.isspmatrix "scipy.sparse.isspmatrix")(x) | *x* 是否为稀疏矩阵类型？ |
| [`isspmatrix_csc`](generated/scipy.sparse.isspmatrix_csc.html#scipy.sparse.isspmatrix_csc "scipy.sparse.isspmatrix_csc")(x) | *x* 是否为 csc_matrix 类型？ |
| [`isspmatrix_csr`](generated/scipy.sparse.isspmatrix_csr.html#scipy.sparse.isspmatrix_csr "scipy.sparse.isspmatrix_csr")(x) | *x* 是否为 csr_matrix 类型？ |
| [`isspmatrix_bsr`](generated/scipy.sparse.isspmatrix_bsr.html#scipy.sparse.isspmatrix_bsr "scipy.sparse.isspmatrix_bsr")(x) | *x* 是否为 bsr_matrix 类型？ |
| [`isspmatrix_lil`](generated/scipy.sparse.isspmatrix_lil.html#scipy.sparse.isspmatrix_lil "scipy.sparse.isspmatrix_lil")(x) | *x* 是否为 lil_matrix 类型？ |
| [`isspmatrix_dok`](generated/scipy.sparse.isspmatrix_dok.html#scipy.sparse.isspmatrix_dok "scipy.sparse.isspmatrix_dok")(x) | *x* 是否为 dok_array 类型？ |
| [`isspmatrix_coo`](generated/scipy.sparse.isspmatrix_coo.html#scipy.sparse.isspmatrix_coo "scipy.sparse.isspmatrix_coo")(x) | *x* 是否为 coo_matrix 类型？ |
| [`isspmatrix_dia`](generated/scipy.sparse.isspmatrix_dia.html#scipy.sparse.isspmatrix_dia "scipy.sparse.isspmatrix_dia")(x) | *x* 是否为 dia_matrix 类型？ |

### 子模块

| [`csgraph`](sparse.csgraph.html#module-scipy.sparse.csgraph "scipy.sparse.csgraph") | 压缩稀疏图例程 (scipy.sparse.csgraph) |
| --- | --- |
| [`linalg`](sparse.linalg.html#module-scipy.sparse.linalg "scipy.sparse.linalg") | 稀疏线性代数 (scipy.sparse.linalg) |

### 异常情况

| [`SparseEfficiencyWarning`](generated/scipy.sparse.SparseEfficiencyWarning.html#scipy.sparse.SparseEfficiencyWarning "scipy.sparse.SparseEfficiencyWarning") |  |
| --- | --- |
| [`SparseWarning`](generated/scipy.sparse.SparseWarning.html#scipy.sparse.SparseWarning "scipy.sparse.SparseWarning") |  |

## 使用信息

有七种可用的稀疏数组类型：

> 1.  [`csc_array`](generated/scipy.sparse.csc_array.html#scipy.sparse.csc_array "scipy.sparse.csc_array"): 压缩稀疏列格式
> 1.  
> 1.  [`csr_array`](generated/scipy.sparse.csr_array.html#scipy.sparse.csr_array "scipy.sparse.csr_array"): 压缩稀疏行格式
> 1.  
> 1.  [`bsr_array`](generated/scipy.sparse.bsr_array.html#scipy.sparse.bsr_array "scipy.sparse.bsr_array"): 块稀疏行格式
> 1.  
> 1.  [`lil_array`](generated/scipy.sparse.lil_array.html#scipy.sparse.lil_array "scipy.sparse.lil_array"): 列表列表格式
> 1.  
> 1.  [`dok_array`](generated/scipy.sparse.dok_array.html#scipy.sparse.dok_array "scipy.sparse.dok_array"): 键字典格式
> 1.  
> 1.  [`coo_array`](generated/scipy.sparse.coo_array.html#scipy.sparse.coo_array "scipy.sparse.coo_array"): COO 格式（即 IJV，三元组格式）
> 1.  
> 1.  [`dia_array`](generated/scipy.sparse.dia_array.html#scipy.sparse.dia_array "scipy.sparse.dia_array"): 对角线格式

要高效构造数组，请使用[`dok_array`](generated/scipy.sparse.dok_array.html#scipy.sparse.dok_array "scipy.sparse.dok_array")或者[`lil_array`](generated/scipy.sparse.lil_array.html#scipy.sparse.lil_array "scipy.sparse.lil_array")。[`lil_array`](generated/scipy.sparse.lil_array.html#scipy.sparse.lil_array "scipy.sparse.lil_array")类支持基本切片和与NumPy数组类似语法的花式索引。正如下文所示，COO格式也可用于高效构造数组。尽管它们与NumPy数组相似，**强烈不建议**直接在这些数组上使用NumPy函数，因为NumPy可能无法正确转换它们以进行计算，导致意外（和错误）的结果。如果确实要在这些数组上应用NumPy函数，请首先检查SciPy是否有适用于给定稀疏数组类的自己的实现，或者在应用方法之前**将稀疏数组转换为NumPy数组**（例如，使用类的`toarray`方法）。

要执行诸如乘法或求逆之类的操作，首先将数组转换为CSC或CSR格式。[`lil_array`](generated/scipy.sparse.lil_array.html#scipy.sparse.lil_array "scipy.sparse.lil_array")格式是基于行的，因此转换为CSR是有效的，而转换为CSC则不太有效。

在CSR、CSC和COO格式之间的所有转换都是高效的、线性时间的操作。

### 矩阵向量乘积

要在稀疏数组和向量之间进行向量乘积，简单地使用数组的`dot`方法，如其文档字符串中所述：

```py
>>> import numpy as np
>>> from scipy.sparse import csr_array
>>> A = csr_array([[1, 2, 0], [0, 0, 3], [4, 0, 5]])
>>> v = np.array([1, 0, -1])
>>> A.dot(v)
array([ 1, -3, -1], dtype=int64) 
```

警告

从NumPy 1.7版本开始，`np.dot`不知道稀疏数组，因此使用它将导致意外的结果或错误。应该首先获得相应的密集数组：

```py
>>> np.dot(A.toarray(), v)
array([ 1, -3, -1], dtype=int64) 
```

但这样一来，所有的性能优势都会丧失。

CSR格式特别适合快速矩阵向量乘积。

### 示例 1

构造一个1000x1000的[`lil_array`](generated/scipy.sparse.lil_array.html#scipy.sparse.lil_array "scipy.sparse.lil_array")并给它添加一些值：

```py
>>> from scipy.sparse import lil_array
>>> from scipy.sparse.linalg import spsolve
>>> from numpy.linalg import solve, norm
>>> from numpy.random import rand 
```

```py
>>> A = lil_array((1000, 1000))
>>> A[0, :100] = rand(100)
>>> A[1, 100:200] = A[0, :100]
>>> A.setdiag(rand(1000)) 
```

现在将其转换为CSR格式并解决 A x = b 得到 x：

```py
>>> A = A.tocsr()
>>> b = rand(1000)
>>> x = spsolve(A, b) 
```

将其转换为密集数组并求解，并检查结果是否相同：

```py
>>> x_ = solve(A.toarray(), b) 
```

现在我们可以计算误差的范数：

```py
>>> err = norm(x-x_)
>>> err < 1e-10
True 
```

应该很小 :)

### 示例 2

在COO格式中构造一个数组：

```py
>>> from scipy import sparse
>>> from numpy import array
>>> I = array([0,3,1,0])
>>> J = array([0,3,1,2])
>>> V = array([4,5,7,9])
>>> A = sparse.coo_array((V,(I,J)),shape=(4,4)) 
```

注意索引不需要排序。

在转换为CSR或CSC时，重复的(i,j)条目将被求和。

```py
>>> I = array([0,0,1,3,1,0,0])
>>> J = array([0,2,1,3,1,0,0])
>>> V = array([1,1,1,1,1,1,1])
>>> B = sparse.coo_array((V,(I,J)),shape=(4,4)).tocsr() 
```

这对于构造有限元刚度和质量矩阵非常有用。

### 进一步细节

CSR列索引不一定排序。同样适用于CSC行索引。当需要排序索引时，请使用`.sorted_indices()`和`.sort_indices()`方法（例如，将数据传递给其他库时）。
